---
description: 
globs: 
alwaysApply: true
---
# ghostspeak Project Rules - Production Excellence Standards

## ðŸŽ¯ **PROJECT IDENTITY: AUTONOMOUS AGENT COMMERCE PROTOCOL**

**Technology Stack**: Multi-language Web3 platform (Rust Smart Contracts + TypeScript/Rust SDKs)  
**Platform**: Solana blockchain with ZK compression  
**Architecture**: Monorepo with workspaces (Anchor + Bun + Cargo)  
**Standards**: Production-ready code only, comprehensive verification required

---

## âš¡ **ABSOLUTE VERIFICATION REQUIREMENTS**

### **MANDATORY PRE-IMPLEMENTATION RESEARCH**
Before ANY code generation:
```bash
# REQUIRED VERIFICATION SEQUENCE:
âœ“ Use Context7: "use context7" for all library/framework queries
âœ“ Web search: Current best practices for technology stack (2025)
âœ“ Memory check: Review .cursor/memory/ for past decisions
âœ“ Validation: Cross-reference multiple authoritative sources
```

### **EVIDENCE-BASED DEVELOPMENT**
Every implementation MUST provide:
- **Proof of concept**: Working minimal example
- **Test evidence**: Comprehensive test suite passes
- **Performance metrics**: Benchmarks when applicable
- **Security validation**: Vulnerability assessment
- **Documentation**: Complete API documentation with examples

---

## ðŸ§¬ **TECHNOLOGY STACK COMPLIANCE**

### **Rust Development (Smart Contracts & SDK)**
```toml
# Required Rust Standards:
âœ“ Edition 2021 minimum
âœ“ Anchor framework 0.31.1+
âœ“ SPL Token 2022 v9.0.0+ (latest extensions)
âœ“ Solana SDK workspace versions
âœ“ Comprehensive error handling with thiserror
âœ“ Full async/await with tokio
âœ“ Production-ready dependency management
```

### **TypeScript Development (SDK & Tools)**
```json
// Required TypeScript Standards:
âœ“ TypeScript 5.8.3+ (latest features)
âœ“ Web3.js v2 (NO v1.x legacy patterns)
âœ“ Modern ESM modules only
âœ“ Strict type checking enabled
âœ“ Tree-shakable modular architecture
âœ“ Comprehensive JSDoc documentation
```

### **Testing Requirements (NON-NEGOTIABLE)**
```javascript
// Jest Configuration Compliance:
âœ“ 85%+ code coverage minimum
âœ“ Unit + Integration + E2E tests
âœ“ Real blockchain testing (no mocks for RPC calls)
âœ“ Performance benchmarks for critical paths
âœ“ Security test suites
âœ“ Solana-bankrun for smart contract tests
```

---

## ðŸ”’ **SECURITY & VERIFICATION PROTOCOLS**

### **Smart Contract Security (CRITICAL)**
```rust
// Required Anchor Program Standards:
âœ“ Input validation on ALL instructions
âœ“ PDA derivation security
âœ“ Access control on ALL mutations
âœ“ Overflow/underflow protection
âœ“ Re-entrancy protection where applicable
âœ“ Account validation and ownership checks
âœ“ Comprehensive error handling
```

### **SDK Security Standards**
```typescript
// Required SDK Security:
âœ“ Input sanitization on all user data
âœ“ Signature verification for transactions
âœ“ Secure keypair generation and handling
âœ“ Network validation (devnet/mainnet)
âœ“ Rate limiting on RPC calls
âœ“ Proper error disclosure (no sensitive leaks)
```

### **Dependency Security (ENFORCED)**
```bash
# Required Security Auditing:
bun audit --audit-level moderate  # NO exceptions
cargo audit                       # NO vulnerabilities
license-checker --summary         # License compliance
```

---

## ðŸ—ï¸ **ARCHITECTURE ENFORCEMENT**

### **Monorepo Structure (MANDATORY)**
```
ghostspeak/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/           # Rust smart contracts (Anchor)
â”‚   â”œâ”€â”€ sdk-typescript/ # TypeScript SDK (Web3.js v2)
â”‚   â”œâ”€â”€ sdk-rust/      # Rust SDK (Modern patterns)
â”‚   â””â”€â”€ cli/           # Command-line tools
â”œâ”€â”€ tests/             # Integration tests
â”œâ”€â”€ docs/              # Architecture documentation
â””â”€â”€ adr/               # Architectural Decision Records
```

### **Code Organization Standards**
```rust
// Rust Module Structure (ENFORCED):
src/
â”œâ”€â”€ lib.rs              # Public API exports
â”œâ”€â”€ client/             # High-level client
â”œâ”€â”€ services/           # Business logic layer
â”œâ”€â”€ instructions/       # Instruction builders
â”œâ”€â”€ accounts/           # Account management
â”œâ”€â”€ types/              # Type definitions
â”œâ”€â”€ errors/             # Error definitions
â””â”€â”€ utils/              # Utility functions
```

```typescript
// TypeScript Module Structure (ENFORCED):
src/
â”œâ”€â”€ index.ts            # Public API exports
â”œâ”€â”€ client/             # SDK client
â”œâ”€â”€ services/           # Service layer
â”œâ”€â”€ instructions/       # Transaction builders
â”œâ”€â”€ accounts/           # Account utilities
â”œâ”€â”€ types/              # Type definitions
â”œâ”€â”€ errors/             # Error classes
â””â”€â”€ utils/              # Utility functions
```

---

## ðŸš€ **DEVELOPMENT WORKFLOW (NON-NEGOTIABLE)**

### **Implementation Sequence (ABSOLUTE)**
1. **Smart Contract First**: All blockchain logic before SDK
2. **Test-Driven Development**: Tests before implementation
3. **Security-First**: Security review before feature completion
4. **Documentation-Complete**: Full docs before merge
5. **Performance-Validated**: Benchmarks before production

### **Code Quality Gates**
```bash
# REQUIRED BEFORE ANY COMMIT:
bun run lint:comprehensive    # ESLint + Clippy (NO warnings)
bun run test:comprehensive    # Full test suite (100% pass)
bun run build:production      # Production build success
bun run audit:all            # Security audit (NO issues)
bun run format:comprehensive  # Code formatting (consistent)
```

### **Verification Loop (MANDATORY)**
```mermaid
graph TD
    A[Generate Code] --> B[Self-Evaluation]
    B --> C[Context7 Research]
    C --> D[Web Search Validation]
    D --> E[Memory Check]
    E --> F[Technical Review]
    F --> G{All Standards Met?}
    G -->|No| H[Research Mode]
    H --> I[Root Cause Analysis]
    I --> A
    G -->|Yes| J[Production Ready]
```

---

## ðŸ“Š **PERFORMANCE & SCALABILITY REQUIREMENTS**

### **Smart Contract Performance**
```rust
// Required Performance Standards:
âœ“ < 200,000 CU per instruction (compute units)
âœ“ Minimal account allocations
âœ“ Efficient PDA usage
âœ“ ZK compression for large data
âœ“ Batch operations where possible
```

### **SDK Performance Standards**
```typescript
// Required SDK Performance:
âœ“ Bundle size < 100KB (CLI), < 50KB (SDK)
âœ“ Tree-shaking effective (unused code eliminated)
âœ“ < 100ms for local operations
âœ“ < 2s for blockchain operations (devnet)
âœ“ Proper connection pooling
âœ“ Intelligent retry mechanisms
```

### **Testing Performance Requirements**
```bash
# Performance Test Standards:
âœ“ Unit tests: < 10s total execution
âœ“ Integration tests: < 60s total execution
âœ“ E2E tests: < 120s total execution
âœ“ Load tests: 1000+ operations/minute
```

---

## ðŸ”¬ **TESTING PROTOCOLS (COMPREHENSIVE)**

### **Smart Contract Testing (CRITICAL)**
```rust
// Required Anchor Test Coverage:
âœ“ Happy path scenarios (100%)
âœ“ Error conditions (100%)
âœ“ Edge cases (overflow, underflow, invalid inputs)
âœ“ Account state transitions
âœ“ Cross-program invocations
âœ“ Security attack vectors
âœ“ Performance benchmarks
```

### **SDK Testing (EXHAUSTIVE)**
```typescript
// Required SDK Test Coverage:
âœ“ Unit tests for all public functions
âœ“ Integration tests with real Solana RPC
âœ“ Error handling for network failures
âœ“ Type safety validation
âœ“ Performance regression tests
âœ“ Security vulnerability tests
âœ“ Example code validation
```

### **E2E Testing (PRODUCTION-LIKE)**
```bash
# Required End-to-End Testing:
âœ“ Complete user workflows
âœ“ Multi-agent interactions
âœ“ Stress testing under load
âœ“ Network failure recovery
âœ“ Security penetration testing
âœ“ Cross-browser compatibility (web components)
```

---

## ðŸ“ **DOCUMENTATION STANDARDS (MANDATORY)**

### **Code Documentation**
```rust
/// Required Rust Documentation:
/// 
/// # Purpose
/// Clear explanation of function purpose
/// 
/// # Arguments
/// * `param` - Detailed parameter description
/// 
/// # Returns
/// Detailed return value description
/// 
/// # Errors
/// All possible error conditions
/// 
/// # Examples
/// ```rust
/// // Working example code
/// ```
/// 
/// # Security
/// Security considerations if applicable
```

```typescript
/**
 * Required TypeScript Documentation:
 * 
 * @description Clear explanation of function purpose
 * @param param - Detailed parameter description
 * @returns Detailed return value description
 * @throws {ErrorType} All possible error conditions
 * @example
 * ```typescript
 * // Working example code
 * ```
 * @security Security considerations if applicable
 */
```

### **Architecture Documentation**
```markdown
# Required for ALL major features:
âœ“ ADR (Architectural Decision Record) in adr/
âœ“ API documentation with OpenAPI/TypeDoc
âœ“ Integration examples with working code
âœ“ Security considerations
âœ“ Performance characteristics
âœ“ Migration guides (when applicable)
```

---

## ðŸš¨ **ABSOLUTE PROHIBITIONS (ZERO TOLERANCE)**

### **Forbidden Code Patterns**
```typescript
// âŒ NEVER ALLOWED:
- TODO comments for critical functionality
- Mock data in production code paths
- Hardcoded values (use constants/config)
- any type usage (use proper types)
- Non-null assertions without justification
- Commented-out code blocks
- console.log in production code
- Synchronous blockchain operations
```

### **Forbidden Development Practices**
```bash
# âŒ NEVER ALLOWED:
- Skipping tests for "quick fixes"
- Deploying without security audit
- Copy-pasting code without understanding
- Pushing with linting errors
- Committing with TODO items
- Using deprecated dependencies
- Bypassing code review process
```

---

## ðŸŽ¯ **SUCCESS CRITERIA & METRICS**

### **Quality Gates (PASS/FAIL)**
```bash
# MUST PASS ALL:
âœ“ Zero ESLint/Clippy warnings
âœ“ 85%+ test coverage
âœ“ Zero security vulnerabilities
âœ“ Performance benchmarks met
âœ“ Documentation complete
âœ“ ADR created for architectural decisions
âœ“ Memory files updated with learnings
```

### **Production Readiness Checklist**
```markdown
Before ANY production deployment:
â–¡ Smart contract audited by third party
â–¡ All SDKs tested on mainnet-fork
â–¡ Performance tested under realistic load
â–¡ Security penetration testing complete
â–¡ Documentation reviewed and updated
â–¡ Rollback procedures documented
â–¡ Monitoring and alerting configured
â–¡ Team trained on new features
```

---

## ðŸ§  **MEMORY SYSTEM INTEGRATION**

### **Required Memory Updates**
After EVERY development session:
```markdown
# Update Required Files:
âœ“ .cursor/memory/activeContext.md - Current objectives, blockers
âœ“ .cursor/memory/progress.md - Tasks completed, in progress, planned
âœ“ .cursor/memory/decisionLog.md - Technical decisions with rationale
âœ“ adr/ - Architectural Decision Records for major choices
```

### **Learning Integration**
```markdown
# Document in Memory:
âœ“ Successful patterns for reuse
âœ“ Failures and root causes
âœ“ Performance optimizations discovered
âœ“ Security considerations learned
âœ“ Tool improvements needed
```

---

## âš¡ **ENFORCEMENT PROTOCOL**

### **Automated Enforcement**
```bash
# Pre-commit hooks (ENFORCED):
bun run pre-commit  # Runs lint + test:critical

# CI/CD gates (MANDATORY):
- All quality gates must pass
- Security scans must complete
- Performance regression tests
- Documentation build verification
```

### **Manual Review Requirements**
```markdown
# Required for ALL pull requests:
â–¡ Code review by senior developer
â–¡ Architecture review for significant changes
â–¡ Security review for blockchain code
â–¡ Performance review for critical paths
â–¡ Documentation review for public APIs
```

---

## ðŸš€ **CONTINUOUS IMPROVEMENT**

### **Weekly Quality Review**
```markdown
# Every Friday - Project Health Check:
â–¡ Review .cursor/memory/progress.md
â–¡ Update performance benchmarks
â–¡ Security vulnerability scan
â–¡ Dependency update review
â–¡ Documentation gap analysis
â–¡ Team retrospective on quality
```

### **Monthly Architecture Review**
```markdown
# Monthly - Architectural Health:
â–¡ Review ADRs for outdated decisions
â–¡ Evaluate new technology opportunities
â–¡ Assess technical debt priorities
â–¡ Plan performance improvements
â–¡ Update development standards
```

---

## ðŸŽ¯ **THE ghostspeak PROMISE**

**When these rules are followed completely:**
- âœ… **Zero production bugs** from AI-generated code
- âœ… **100% security compliance** for blockchain operations
- âœ… **Predictable performance** under all conditions
- âœ… **Complete documentation** for all public APIs
- âœ… **Maintainable codebase** for long-term success

**Either your code meets these production standards, or it doesn't ship.**

---

*"Building the future of autonomous agent commerce - with uncompromising quality standards."* 